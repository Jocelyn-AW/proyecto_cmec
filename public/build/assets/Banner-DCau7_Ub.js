import{y as re,g,a as f,b as u,h as oe,d as a,f as k,w as c,o as b,i as A,t as x,j as D,x as I,z as _,q as n,p as F,k as le}from"./app-TN2NL2-O.js";import{d as se}from"./vuedraggable.umd-D5Lf4LIO.js";import{_ as ne}from"./AuthenticatedLayout-BIWs3sPN.js";import{_ as N}from"./Modal-BmmOXwUG.js";import{_ as ie}from"./Alerta-D-a_CENt.js";import{u as de}from"./useAlert-BFzRyHFi.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-DFoQj1pd.js";const ce={class:"p-6 border-t border-gray-100 dark:border-gray-800 sm:p-6 lg:ml-[290px]"},me={class:"space-y-5"},ge={class:"overflow-hidden rounded-2xl border border-gray-200 bg-white pt-4 dark:border-gray-800 dark:bg-white/[0.03]"},be={class:"block px-5 pb-4"},pe={class:"space-y-4"},ve={class:"w-28 h-20 flex-shrink-0 overflow-hidden rounded"},fe=["src"],xe={class:"flex-1 min-w-0"},he={class:"text-base font-medium leading-6 text-gray-800 dark:text-white/90 truncate"},we={key:0,class:"text-sm text-blue-600 truncate max-w-full"},ye=["href"],ke={key:1,class:"text-sm text-gray-400"},_e={class:"flex-shrink-0 flex items-center gap-2"},Ce=["onClick"],Be=["onClick"],Ee={class:"p-6 space-y-4"},je={key:0,class:"mb-4"},ze={class:"w-full h-48 overflow-hidden rounded-lg border border-gray-300"},Me=["src"],Le=["disabled"],Pe=["disabled"],Te={class:"p-6 space-y-4"},Ae={class:"mb-4"},De={class:"block text-sm font-medium text-gray-700 mb-2"},Ie={class:"w-full h-48 overflow-hidden rounded-lg border border-gray-300"},Fe=["src"],Ne=["disabled"],Se=["disabled"],Ve=Object.assign({layout:ne},{__name:"Banner",props:{banners:{type:Array,default:()=>[]}},setup(S){const L=S,{alertState:s,success:h,errorA:C,warning:w,info:V}=de(),B=n(!1),E=n(!1),$=n(!0),i=n([]),j=n([]),P=n(!1),l=n({image:null,link:"",order:0}),o=n({id:null,image:null,link:"",order:0,currentImage:null}),y=n(null),p=n(null),d=n(!1),O=le(()=>i.value.length===0?0:Math.max(...i.value.map(e=>e.order??0))+1);re(()=>L.banners,()=>{const t=[...L.banners].sort((e,r)=>(e.order??0)-(r.order??0));i.value=t.map(e=>({...e})),j.value=t.map(e=>({...e}))},{immediate:!0});const G=t=>!0,R=()=>{P.value=!0},U=()=>{P.value=!1},W=async()=>{try{const t={banners:i.value.map((e,r)=>({id:e.id,order:r}))};await _.post("/banners/reorder",t),j.value=i.value.map(e=>({...e})),console.log("Orden actualizado exitosamente"),h("Orden actualizado correctamente")}catch(t){console.error(t),C("Error actualizando el orden")}},H=()=>{i.value=j.value.map(t=>({...t}))},J=t=>{w("¿Estás seguro de eliminar este banner?",{title:"Eliminar banner",buttonText:"Eliminar",cancelText:"Cancelar",onConfirm:async()=>{await _.delete(`/banners/${t}`),i.value=i.value.filter(e=>e.id!==t),h("Banner eliminado correctamente")}})},q=()=>{s.value.onConfirm?.(),s.value.show=!1},K=()=>{s.value.onCancel?.(),s.value.show=!1},Q=()=>{T(),l.value.order=O.value,B.value=!0},z=()=>{B.value=!1,T()},T=()=>{l.value={image:null,link:"",order:0},y.value=null},X=t=>{const e=t.target.files[0];if(e){if(e.size>1048576){w("La imagen no debe superar 1MB"),t.target.value="";return}l.value.image=e;const m=new FileReader;m.onload=v=>{y.value=v.target.result},m.readAsDataURL(e)}},Y=async()=>{if(!l.value.image){V("Por favor selecciona una imagen");return}d.value=!0;try{const t=new FormData;t.append("image",l.value.image),t.append("order",l.value.order),l.value.link&&l.value.link.trim()!==""&&t.append("link",l.value.link),(await _.post("/banners",t,{headers:{"Content-Type":"multipart/form-data"}})).data.message==="success"&&(z(),F.reload({only:["banners"]}),h("El banner ha sido creado correctamente"))}catch(t){console.error("Error creando banner:",t),C("Error al crear el banner")}finally{d.value=!1}},Z=t=>{const e=i.value.find(r=>r.id===t);if(!e){w("Banner no encontrado");return}o.value={id:e.id,image:null,link:e.link||"",order:e.order,currentImage:e.image},p.value=null,E.value=!0},M=()=>{E.value=!1,ee()},ee=()=>{o.value={id:null,image:null,link:"",order:0,currentImage:null},p.value=null},ae=t=>{const e=t.target.files[0];if(e){if(e.size>1048576){w("La imagen no debe superar 1MB"),t.target.value="";return}o.value.image=e;const m=new FileReader;m.onload=v=>{p.value=v.target.result},m.readAsDataURL(e)}},te=async()=>{d.value=!0;try{const t=new FormData;t.append("order",o.value.order),o.value.link&&o.value.link.trim()!==""&&t.append("link",o.value.link),o.value.image&&t.append("image",o.value.image),(await _.post(`/banners/${o.value.id}`,t,{headers:{"Content-Type":"multipart/form-data"}})).data.message==="success"&&(M(),F.reload({only:["banners"]}),h("El banner ha sido actualizado correctamente"))}catch(t){console.error("Error actualizando banner:",t),C("Error al actualizar el banner")}finally{d.value=!1}};return(t,e)=>(b(),g("div",null,[f(u(oe),{title:"Banners"}),a("div",ce,[a("div",me,[e[7]||(e[7]=a("div",{class:"flex flex-col gap-5 px-6 mb-4 sm:flex-row sm:items-center sm:justify-between"},[a("div",null,[a("h3",{class:"text-lg font-semibold text-gray-800 dark:text-white/90"},"Banners"),a("p",{class:"text-sm text-gray-500"},'Arrastra las filas para reordenar y pulsa "Guardar orden" ')])],-1)),a("div",ge,[a("div",{class:"flex flex-col sm:flex-row items-center justify-between gap-4 px-6 mb-4"},[a("div",{class:"flex items-center gap-2 w-full sm:w-auto"},[a("button",{onClick:H,class:"inline-flex h-10 w-full sm:w-auto justify-center items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors"}," Cancelar "),a("button",{onClick:W,class:"inline-flex h-10 w-full sm:w-auto justify-center items-center gap-2 rounded-lg bg-zinc-900 text-white px-4 py-2.5 text-sm font-medium hover:bg-zinc-800 transition-colors"}," Guardar orden ")]),e[4]||(e[4]=a("p",{class:"text-sm text-amber-600 dark:text-amber-500"}," ⚠️ Las imágenes deben pesar máximo 1MB ",-1)),a("button",{onClick:Q,class:"inline-flex h-10 w-full sm:w-auto justify-center items-center gap-2 rounded-lg bg-green-600 text-white px-4 py-2.5 text-sm font-medium hover:bg-green-700 transition-colors shadow-sm"},[...e[3]||(e[3]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[a("path",{d:"M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"})],-1),k(" Nuevo banner ",-1)])])]),a("div",be,[a("div",pe,[f(u(se),{list:i.value,disabled:!$.value,"ghost-class":"ghost",move:G,"item-key":"id",onStart:R,onEnd:U},{item:c(({element:r,index:m})=>[(b(),g("div",{key:r.id,class:"bg-white dark:bg-white/[0.03] border border-gray-200 dark:border-gray-800 rounded-2xl p-6 flex items-center gap-4 hover:shadow-sm transition-shadow"},[a("div",ve,[r.image?(b(),g("img",{key:0,src:r.image,class:"w-full h-full object-cover"},null,8,fe)):A("",!0)]),a("div",xe,[a("div",he,x(r.name),1),r.link?(b(),g("div",we,[a("a",{href:r.link,target:"_blank",class:"hover:underline"},x(r.link),9,ye)])):(b(),g("div",ke,"— sin link —"))]),a("div",_e,[a("button",{onClick:v=>Z(r.id),title:"Editar",class:"p-2.5 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white transition-colors border border-blue-100 hover:border-blue-600"},[...e[5]||(e[5]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})],-1)])],8,Ce),a("button",{onClick:v=>J(r.id),title:"Eliminar",class:"p-2.5 rounded-lg bg-red-50 text-red-600 hover:bg-red-600 hover:text-white transition-colors border border-red-100 hover:border-red-600"},[...e[6]||(e[6]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})],-1)])],8,Be)])]))]),_:1},8,["list","disabled"])])])])])]),f(N,{show:B.value,onClose:z,maxWidth:"2xl"},{title:c(()=>[...e[8]||(e[8]=[k(" Crear banner ",-1)])]),footer:c(()=>[a("button",{onClick:z,disabled:d.value,class:"rounded-md border border-transparent py-2 px-4 text-sm text-slate-600 transition-all hover:bg-slate-100 disabled:opacity-50"}," Cancelar ",8,Le),a("button",{onClick:Y,disabled:d.value||!l.value.image,class:"rounded-md bg-green-600 py-2 px-4 text-sm text-white transition-all shadow-md hover:bg-green-700 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"},x(d.value?"Creando...":"Crear banner"),9,Pe)]),default:c(()=>[a("div",Ee,[y.value?(b(),g("div",je,[e[9]||(e[9]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Vista previa",-1)),a("div",ze,[a("img",{src:y.value,class:"w-full h-full object-cover",alt:"Preview"},null,8,Me)])])):A("",!0),a("div",null,[e[10]||(e[10]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[k(" Imagen "),a("span",{class:"text-red-500"},"*")],-1)),a("input",{type:"file",accept:"image/jpeg,image/png,image/jpg,image/webp",onChange:X,class:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none"},null,32),e[11]||(e[11]=a("p",{class:"mt-1 text-xs text-gray-500"}," Formato permitido: JPG, PNG, WEBP (Peso máx. 1MB) ",-1))]),a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Link (opcional) ",-1)),D(a("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>l.value.link=r),type:"text",placeholder:"https://ejemplo.com",class:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-green-500 focus:ring-green-500"},null,512),[[I,l.value.link]])])])]),_:1},8,["show"]),f(N,{show:E.value,onClose:M,maxWidth:"2xl"},{title:c(()=>[...e[13]||(e[13]=[k(" Editar banner ",-1)])]),footer:c(()=>[a("button",{onClick:M,disabled:d.value,class:"rounded-md border border-transparent py-2 px-4 text-sm text-slate-600 transition-all hover:bg-slate-100 disabled:opacity-50"}," Cancelar ",8,Ne),a("button",{onClick:te,disabled:d.value,class:"rounded-md bg-blue-600 py-2 px-4 text-sm text-white transition-all shadow-md hover:bg-blue-700 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"},x(d.value?"Actualizando...":"Actualizar banner"),9,Se)]),default:c(()=>[a("div",Te,[a("div",Ae,[a("label",De,x(p.value?"Nueva imagen":"Imagen actual"),1),a("div",Ie,[a("img",{src:p.value||o.value.currentImage,class:"w-full h-full object-cover",alt:"Banner"},null,8,Fe)])]),a("div",null,[e[14]||(e[14]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Cambiar imagen (opcional) ",-1)),a("input",{type:"file",accept:"image/jpeg,image/png,image/jpg,image/webp",onChange:ae,class:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none"},null,32),e[15]||(e[15]=a("p",{class:"mt-1 text-xs text-gray-500"}," Formato permitido: JPG, PNG, WEBP (Peso máx. 1MB). Deja vacío para mantener la imagen actual. ",-1))]),a("div",null,[e[16]||(e[16]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Link (opcional) ",-1)),D(a("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.link=r),type:"text",placeholder:"https://ejemplo.com",class:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[I,o.value.link]])])])]),_:1},8,["show"]),f(ie,{show:u(s).show,message:u(s).message,title:u(s).title,type:u(s).type,buttonText:u(s).buttonText,cancelText:u(s).cancelText,onConfirm:q,onCancel:K,onClose:e[2]||(e[2]=r=>u(s).show=!1)},null,8,["show","message","title","type","buttonText","cancelText"])]))}}),Ke=ue(Ve,[["__scopeId","data-v-afe36c5f"]]);export{Ke as default};
