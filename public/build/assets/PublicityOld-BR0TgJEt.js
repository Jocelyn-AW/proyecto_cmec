import{y as le,g as p,a as f,b as u,h as oe,d as t,f as k,w as c,o as g,i as A,t as x,j as D,x as I,z as _,q as i,p as F,k as re}from"./app-DK0nqKl3.js";import{d as se}from"./vuedraggable.umd-BzGJhlsL.js";import{_ as ie}from"./AuthenticatedLayout-huTq0u-n.js";import{_ as N}from"./Modal-zXR-PI-w.js";import{_ as ne}from"./Alerta-Cuz6Xr8h.js";import{u as de}from"./useAlert-UeAE-bRV.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-1ZfZOzJW.js";const ce={class:"p-6 border-t border-gray-100 dark:border-gray-800 sm:p-6 lg:ml-[290px]"},me={class:"space-y-5"},pe={class:"overflow-hidden rounded-2xl border border-gray-200 bg-white pt-4 dark:border-gray-800 dark:bg-white/[0.03]"},ge={class:"block px-5 pb-4"},be={class:"space-y-4"},ve={class:"w-28 h-20 flex-shrink-0 overflow-hidden rounded"},fe=["src"],xe={class:"flex-1 min-w-0"},he={class:"text-base font-medium leading-6 text-gray-800 dark:text-white/90 truncate"},we={key:0,class:"text-sm text-blue-600 truncate max-w-full"},ye=["href"],ke={key:1,class:"text-sm text-gray-400"},_e={class:"flex-shrink-0 flex items-center gap-2"},Ce=["onClick"],Pe=["onClick"],je={class:"p-6 space-y-4"},Ee={key:0,class:"mb-4"},Me={class:"w-full h-48 overflow-hidden rounded-lg border border-gray-300"},ze=["src"],Le=["disabled"],Be=["disabled"],Te={class:"p-6 space-y-4"},Ae={class:"mb-4"},De={class:"block text-sm font-medium text-gray-700 mb-2"},Ie={class:"w-full h-48 overflow-hidden rounded-lg border border-gray-300"},Fe=["src"],Ne=["disabled"],Oe=["disabled"],Se=Object.assign({layout:ie},{__name:"PublicityOld",props:{posts:{type:Array,default:()=>[]}},setup(O){const L=O,{alertState:s,success:h,errorA:C,warning:w,info:S}=de(),P=i(!1),j=i(!1),V=i(!0),n=i([]),E=i([]),B=i(!1),r=i({image:null,link:"",order:0}),o=i({id:null,image:null,link:"",order:0,currentImage:null}),y=i(null),b=i(null),d=i(!1),$=re(()=>n.value.length===0?0:Math.max(...n.value.map(e=>e.order??0))+1);le(()=>L.posts,()=>{const a=[...L.posts].sort((e,l)=>(e.order??0)-(l.order??0));n.value=a.map(e=>({...e})),E.value=a.map(e=>({...e}))},{immediate:!0});const G=a=>!0,R=()=>{B.value=!0},U=()=>{B.value=!1},W=async()=>{try{const a={posts:n.value.map((e,l)=>({id:e.id,order:l}))};await _.post("/publicity/reorder",a),E.value=n.value.map(e=>({...e})),h("Orden actualizado correctamente")}catch{C("Error actualizando el orden")}},H=()=>{n.value=E.value.map(a=>({...a}))},J=a=>{w("¿Estás seguro de eliminar esta publicidad?",{title:"Eliminar publicidad",buttonText:"Eliminar",cancelText:"Cancelar",onConfirm:async()=>{await _.delete(`/publicity/${a}`),n.value=n.value.filter(e=>e.id!==a),h("Publicidad eliminada correctamente")}})},q=()=>{s.value.onConfirm?.(),s.value.show=!1},K=()=>{s.value.onCancel?.(),s.value.show=!1},Q=()=>{T(),r.value.order=$.value,P.value=!0},M=()=>{P.value=!1,T()},T=()=>{r.value={image:null,link:"",order:0},y.value=null},X=a=>{const e=a.target.files[0];if(e){if(e.size>1048576){w("La imagen no debe superar 1MB"),a.target.value="";return}r.value.image=e;const m=new FileReader;m.onload=v=>{y.value=v.target.result},m.readAsDataURL(e)}},Y=async()=>{if(!r.value.image){S("Por favor selecciona una imagen");return}d.value=!0;try{const a=new FormData;a.append("image",r.value.image),a.append("order",r.value.order),r.value.link&&r.value.link.trim()!==""&&a.append("link",r.value.link),(await _.post("/publicity",a,{headers:{"Content-Type":"multipart/form-data"}})).data.message==="success"&&(M(),F.reload({only:["posts"]}),h("La publicidad ha sido creada correctamente"))}catch{C("Error al crear la publicidad")}finally{d.value=!1}},Z=a=>{const e=n.value.find(l=>l.id===a);if(!e){w("Publicidad no encontrada");return}o.value={id:e.id,image:null,link:e.link||"",order:e.order,currentImage:e.image},b.value=null,j.value=!0},z=()=>{j.value=!1,ee()},ee=()=>{o.value={id:null,image:null,link:"",order:0,currentImage:null},b.value=null},te=a=>{const e=a.target.files[0];if(e){if(e.size>1048576){w("La imagen no debe superar 1MB"),a.target.value="";return}o.value.image=e;const m=new FileReader;m.onload=v=>{b.value=v.target.result},m.readAsDataURL(e)}},ae=async()=>{d.value=!0;try{const a=new FormData;a.append("order",o.value.order),o.value.link&&o.value.link.trim()!==""&&a.append("link",o.value.link),o.value.image&&a.append("image",o.value.image),(await _.post(`/publicity/${o.value.id}`,a,{headers:{"Content-Type":"multipart/form-data"}})).data.message==="success"&&(z(),F.reload({only:["posts"]}),h("La publicidad ha sido actualizada correctamente"))}catch{C("Error al actualizar la publicidad")}finally{d.value=!1}};return(a,e)=>(g(),p("div",null,[f(u(oe),{title:"Publicidad"}),t("div",ce,[t("div",me,[e[7]||(e[7]=t("div",{class:"flex flex-col gap-5 px-6 mb-4 sm:flex-row sm:items-center sm:justify-between"},[t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-white/90"},"Publicidad"),t("p",{class:"text-sm text-gray-500"},'Arrastra las filas para reordenar y pulsa "Guardar orden" ')])],-1)),t("div",pe,[t("div",{class:"flex flex-col sm:flex-row items-center justify-between gap-4 px-6 mb-4"},[t("div",{class:"flex items-center gap-2 w-full sm:w-auto"},[t("button",{onClick:H,class:"inline-flex h-10 w-full sm:w-auto justify-center items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors"}," Cancelar "),t("button",{onClick:W,class:"inline-flex h-10 w-full sm:w-auto justify-center items-center gap-2 rounded-lg bg-zinc-900 text-white px-4 py-2.5 text-sm font-medium hover:bg-zinc-800 transition-colors"}," Guardar orden ")]),e[4]||(e[4]=t("p",{class:"text-sm text-amber-600 dark:text-amber-500"}," ⚠️ Las imágenes deben pesar máximo 1MB ",-1)),t("button",{onClick:Q,class:"inline-flex h-10 w-full sm:w-auto justify-center items-center gap-2 rounded-lg bg-green-600 text-white px-4 py-2.5 text-sm font-medium hover:bg-green-700 transition-colors shadow-sm"},[...e[3]||(e[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[t("path",{d:"M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"})],-1),k(" Nueva publicidad ",-1)])])]),t("div",ge,[t("div",be,[f(u(se),{list:n.value,disabled:!V.value,"ghost-class":"ghost",move:G,"item-key":"id",onStart:R,onEnd:U},{item:c(({element:l,index:m})=>[(g(),p("div",{key:l.id,class:"bg-white dark:bg-white/[0.03] border border-gray-200 dark:border-gray-800 rounded-2xl p-6 flex items-center gap-4 hover:shadow-sm transition-shadow"},[t("div",ve,[l.image?(g(),p("img",{key:0,src:l.image,class:"w-full h-full object-cover"},null,8,fe)):A("",!0)]),t("div",xe,[t("div",he,x(l.name),1),l.link?(g(),p("div",we,[t("a",{href:l.link,target:"_blank",class:"hover:underline"},x(l.link),9,ye)])):(g(),p("div",ke,"— sin link —"))]),t("div",_e,[t("button",{onClick:v=>Z(l.id),title:"Editar",class:"p-2.5 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white transition-colors border border-blue-100 hover:border-blue-600"},[...e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})],-1)])],8,Ce),t("button",{onClick:v=>J(l.id),title:"Eliminar",class:"p-2.5 rounded-lg bg-red-50 text-red-600 hover:bg-red-600 hover:text-white transition-colors border border-red-100 hover:border-red-600"},[...e[6]||(e[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})],-1)])],8,Pe)])]))]),_:1},8,["list","disabled"])])])])])]),f(N,{show:P.value,onClose:M,maxWidth:"2xl"},{title:c(()=>[...e[8]||(e[8]=[k(" Crear publicidad ",-1)])]),footer:c(()=>[t("button",{onClick:M,disabled:d.value,class:"rounded-md border border-transparent py-2 px-4 text-sm text-slate-600 transition-all hover:bg-slate-100 disabled:opacity-50"}," Cancelar ",8,Le),t("button",{onClick:Y,disabled:d.value||!r.value.image,class:"rounded-md bg-green-600 py-2 px-4 text-sm text-white transition-all shadow-md hover:bg-green-700 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"},x(d.value?"Creando...":"Crear publicidad"),9,Be)]),default:c(()=>[t("div",je,[y.value?(g(),p("div",Ee,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Vista previa",-1)),t("div",Me,[t("img",{src:y.value,class:"w-full h-full object-cover",alt:"Preview"},null,8,ze)])])):A("",!0),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[k(" Imagen "),t("span",{class:"text-red-500"},"*")],-1)),t("input",{type:"file",accept:"image/jpeg,image/png,image/jpg,image/webp",onChange:X,class:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none"},null,32),e[11]||(e[11]=t("p",{class:"mt-1 text-xs text-gray-500"}," Formato permitido: JPG, PNG, WEBP (Peso máx. 1MB) ",-1))]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Link (opcional) ",-1)),D(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>r.value.link=l),type:"text",placeholder:"https://ejemplo.com",class:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-green-500 focus:ring-green-500"},null,512),[[I,r.value.link]])])])]),_:1},8,["show"]),f(N,{show:j.value,onClose:z,maxWidth:"2xl"},{title:c(()=>[...e[13]||(e[13]=[k(" Editar publicidad ",-1)])]),footer:c(()=>[t("button",{onClick:z,disabled:d.value,class:"rounded-md border border-transparent py-2 px-4 text-sm text-slate-600 transition-all hover:bg-slate-100 disabled:opacity-50"}," Cancelar ",8,Ne),t("button",{onClick:ae,disabled:d.value,class:"rounded-md bg-blue-600 py-2 px-4 text-sm text-white transition-all shadow-md hover:bg-blue-700 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"},x(d.value?"Actualizando...":"Actualizar publicidad"),9,Oe)]),default:c(()=>[t("div",Te,[t("div",Ae,[t("label",De,x(b.value?"Nueva imagen":"Imagen actual"),1),t("div",Ie,[t("img",{src:b.value||o.value.currentImage,class:"w-full h-full object-cover",alt:"Publicidad"},null,8,Fe)])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Cambiar imagen (opcional) ",-1)),t("input",{type:"file",accept:"image/jpeg,image/png,image/jpg,image/webp",onChange:te,class:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none"},null,32),e[15]||(e[15]=t("p",{class:"mt-1 text-xs text-gray-500"}," Formato permitido: JPG, PNG, WEBP (Peso máx. 1MB). Deja vacío para mantener la imagen actual. ",-1))]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Link (opcional) ",-1)),D(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.link=l),type:"text",placeholder:"https://ejemplo.com",class:"block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[I,o.value.link]])])])]),_:1},8,["show"]),f(ne,{show:u(s).show,message:u(s).message,title:u(s).title,type:u(s).type,buttonText:u(s).buttonText,cancelText:u(s).cancelText,onConfirm:q,onCancel:K,onClose:e[2]||(e[2]=l=>u(s).show=!1)},null,8,["show","message","title","type","buttonText","cancelText"])]))}}),Ke=ue(Se,[["__scopeId","data-v-694aa8aa"]]);export{Ke as default};
